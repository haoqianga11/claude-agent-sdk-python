<mxfile host="app.diagrams.net" modified="2025-01-09T00:00:00.000Z" agent="5.0" etag="claude-sdk" version="21.1.2" type="device">
  <diagram name="Claude SDK 数据流架构" id="claude-sdk-flow">
    <mxGraphModel dx="2074" dy="1194" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- 用户应用层 -->
        <mxCell id="user-app" value="用户应用" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Python SDK 层 -->
        <mxCell id="query-func" value="query() 函数&#xa;(简单查询)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="40" y="140" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="client-class" value="ClaudeSDKClient&#xa;(交互式客户端)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="200" y="140" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- 内部组件层 -->
        <mxCell id="internal-client" value="InternalClient&#xa;(内部客户端)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="120" y="240" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- 传输层 -->
        <mxCell id="transport" value="SubprocessCLITransport&#xa;(子进程传输)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="120" y="340" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Claude Code CLI -->
        <mxCell id="claude-cli" value="Claude Code CLI" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="120" y="440" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Anthropic API -->
        <mxCell id="anthropic-api" value="Anthropic API" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="120" y="540" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- 扩展功能组件 -->
        <mxCell id="mcp-server" value="SDK MCP 服务器&#xa;(进程内工具)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#e6d0de;strokeColor=#996185;" vertex="1" parent="1">
          <mxGeometry x="360" y="200" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="hooks" value="钩子系统&#xa;(Hooks)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#e6d0de;strokeColor=#996185;" vertex="1" parent="1">
          <mxGeometry x="360" y="270" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="permissions" value="权限管理&#xa;(Permissions)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#e6d0de;strokeColor=#996185;" vertex="1" parent="1">
          <mxGeometry x="360" y="340" width="120" height="50" as="geometry" />
        </mxCell>

        <!-- 数据流箭头 -->
        <mxCell id="flow1" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="140" y="100" as="sourcePoint" />
            <mxPoint x="140" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow1-label" value="1. 调用 API" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="150" y="110" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow2" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="240" y="100" as="sourcePoint" />
            <mxPoint x="240" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow3" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="140" y="200" as="sourcePoint" />
            <mxPoint x="140" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow3-label" value="2. 配置选项" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="150" y="210" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow4" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="240" y="200" as="sourcePoint" />
            <mxPoint x="240" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow5" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="300" as="sourcePoint" />
            <mxPoint x="190" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow5-label" value="3. 启动子进程" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="200" y="310" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow6" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="400" as="sourcePoint" />
            <mxPoint x="190" y="440" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow6-label" value="4. JSON 流" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="200" y="410" width="70" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow7" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="500" as="sourcePoint" />
            <mxPoint x="190" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow7-label" value="5. HTTP 请求" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="200" y="510" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- 响应流箭头 -->
        <mxCell id="response1" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#006600;curved=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="540" as="sourcePoint" />
            <mxPoint x="210" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="response1-label" value="6. 响应" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#006600;" vertex="1" parent="1">
          <mxGeometry x="220" y="510" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="response2" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#006600;curved=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="440" as="sourcePoint" />
            <mxPoint x="210" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="response2-label" value="7. JSON 流响应" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#006600;" vertex="1" parent="1">
          <mxGeometry x="220" y="410" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="response3" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#006600;curved=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="340" as="sourcePoint" />
            <mxPoint x="210" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="response3-label" value="8. 解析消息" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#006600;" vertex="1" parent="1">
          <mxGeometry x="220" y="310" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="response4" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#006600;curved=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="160" y="240" as="sourcePoint" />
            <mxPoint x="160" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="response4-label" value="9. 类型化消息" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#006600;" vertex="1" parent="1">
          <mxGeometry x="30" y="210" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="response5" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#006600;curved=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="160" y="140" as="sourcePoint" />
            <mxPoint x="160" y="100" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="response5-label" value="10. 结构化响应" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#006600;" vertex="1" parent="1">
          <mxGeometry x="30" y="110" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- 扩展功能连接线 -->
        <mxCell id="ext1" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=1;strokeColor=#996185;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="340" y="225" as="sourcePoint" />
            <mxPoint x="260" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="ext2" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=1;strokeColor=#996185;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="340" y="295" as="sourcePoint" />
            <mxPoint x="260" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="ext3" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=1;strokeColor=#996185;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="340" y="365" as="sourcePoint" />
            <mxPoint x="260" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 消息解析器 -->
        <mxCell id="message-parser" value="MessageParser&#xa;(消息解析器)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="280" y="410" width="100" height="40" as="geometry" />
        </mxCell>

        <mxCell id="parser-connection" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=1;strokeColor=#6c8ebf;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="430" as="sourcePoint" />
            <mxPoint x="280" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 图例 -->
        <mxCell id="legend-title" value="图例" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="40" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-flow" value="请求数据流" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="520" y="80" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-flow-arrow" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="85" as="sourcePoint" />
            <mxPoint x="560" y="85" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="legend-response" value="响应数据流" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#006600;" vertex="1" parent="1">
          <mxGeometry x="520" y="110" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-response-arrow" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#006600;curved=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="115" as="sourcePoint" />
            <mxPoint x="560" y="115" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="legend-extension" value="扩展功能" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="520" y="140" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-extension-arrow" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=1;strokeColor=#996185;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="145" as="sourcePoint" />
            <mxPoint x="560" y="145" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 技术说明框 -->
        <mxCell id="tech-notes-title" value="技术特点" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="200" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="tech-notes" value="• 异步架构 (anyio)&#xa;• 流式处理&#xa;• 进程内 MCP 服务器&#xa;• JSON 流协议&#xa;• 类型安全 (mypy)&#xa;• 自动错误处理" style="rounded=0;whiteSpace=wrap;html=1;fontSize=12;align=left;verticalAlign=top;strokeColor=#cccccc;fillColor=#f9f9f9;" vertex="1" parent="1">
          <mxGeometry x="520" y="230" width="200" height="120" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>